#!/usr/bin/env node
const shell=require("shelljs"),run=e=>shell.exec(e).output;shell.which("git")||(shell.echo("Sorry, this script requires git"),shell.exit(1));const branch=run("git branch --show-current"),jira_matcher=/\d+-[A-Z]+(?!-?[a-zA-Z]{1,10})/g,getTicketNameFromText=e=>{const t=(e="")=>[...e].reverse().join(""),r=t(e).match(jira_matcher)||[];if(0===r.length)return"";return r.map(t)[0]+": "},wordToEmojiMap={add:"💪",include:"💪",introduce:"💪",alert:"🛎",attach:"🖇",change:"🧬",tweak:"🧬",complete:"✅",completes:"✅",coverage:"☂",delete:"🕊",extend:"💪",fix:"🔧",implement:"💪",improve:"🎉",merge:"♻️",modify:"🔨",pass:"✅",passes:"✅",refactor:"🔨",remove:"🕊",rename:"🖊",return:"💪",revert:"❌",cancel:"❌",forbid:"❗",restrain:"❗",limit:"❗",show:"👁",test:"🥽",update:"👌",use:"🤝",deliver:"🤝",release:"🎂",bring:"👌",return:"🧬",revert:"🧬"},getEmojiFromText=(e="")=>{const t=e.toLowerCase().split(" "),r=["","s","es","ed","d"];for(let e=0;e<t.length;e++)for(let s=0;s<r.length;s++){const i=wordToEmojiMap[t[e]+r[s]];if(i)return i}return""},getUserProvidedMessage=()=>{const e=process.argv.splice(2).join(" ").trim();return 0===e.length?"🔨 commit without message":e},message=getUserProvidedMessage(),emoji=getEmojiFromText(message),ticket=getTicketNameFromText(branch),commitMessage=`${ticket}${emoji}${message}`.replace(/"/g,'\\"');run(`git commit -m "${commitMessage}"`);