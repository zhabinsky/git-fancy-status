#!/usr/bin/env node
const shell=require("shelljs"),run=e=>shell.exec(e).output;shell.which("git")||(shell.echo("Sorry, this script requires git"),shell.exit(1));const branch=run("git branch"),jira_matcher=/\d+-[A-Z]+(?!-?[a-zA-Z]{1,10})/g,getTicketNameFromText=e=>{const t=(e="")=>[...e].reverse().join(""),r=t(e).match(jira_matcher)||[];if(0===r.length)return"";return r.map(t)[0]+": "},wordToEmojiMap={add:"ðŸ’ª",include:"ðŸ’ª",introduce:"ðŸ’ª",alert:"ðŸ›Ž",attach:"ðŸ–‡",change:"ðŸ§¬",tweak:"ðŸ§¬",complete:"âœ…",completes:"âœ…",coverage:"â˜‚",delete:"ðŸ•Š",extend:"ðŸ’ª",fix:"ðŸ”§",implement:"ðŸ’ª",improve:"ðŸŽ‰",merge:"â™»ï¸",modify:"ðŸ”¨",pass:"âœ…",passes:"âœ…",refactor:"ðŸ”¨",remove:"ðŸ•Š",rename:"ðŸ–Š",return:"ðŸ’ª",revert:"âŒ",cancel:"âŒ",forbid:"â—",restrain:"â—",limit:"â—",show:"ðŸ‘",test:"ðŸ¥½",update:"ðŸ‘Œ",use:"ðŸ¤"},getEmojiFromText=(e="")=>{const t=e.toLowerCase().split(" ");for(let e=0;e<t.length;e++){const r=t[e],o=wordToEmojiMap[r];if(o)return o;const s=wordToEmojiMap[r+"s"];if(s)return s;const i=wordToEmojiMap[r+"es"];if(i)return i;const m=wordToEmojiMap[r+"ed"];if(m)return m;const a=wordToEmojiMap[r+"d"];if(a)return a}return""},getUserProvidedMessage=()=>{const e=process.argv.splice(2).join(" ").trim();return 0===e.length?"ðŸ”¨ commit without message":e},message=getUserProvidedMessage(),emoji=getEmojiFromText(message),ticket=getTicketNameFromText(branch),commitMessage=`${ticket}${emoji}${message}`.replace(/"/g,'\\"');run(`git commit -m "${commitMessage}"`);